// JavaScript Document
paths = {
    arucas: {
        path: "m 326.02673,59.221977 -10.35406,-9.343911 -5.3033,1.515229 -7.82868,-5.808377 -3.53554,3.282996 -8.08122,-9.343911 -7.82868,0.505076 0,3.030457 -4.04061,-0.505076 -7.07107,5.050763 -10.6066,1.010152 -3.03046,6.313454 11.8693,-4.293148 4.54568,1.010152 2.77792,12.121831 -8.08122,18.687822 4.29315,5.808377 -8.08122,13.131987 3.78807,6.06091 17.93021,3.283 8.08122,-2.77792 1.76777,-8.586299 10.35406,-5.555839 1.76777,-4.798225 3.53553,-0.757614 2.52538,-10.85914 1.51523,-0.252538 -2.0203,-5.808377 4.29314,-0.505077 z",
        name: "arucas",
        meteo_code: "35006"
    },
    "las-palmas-de-gc": {
        name: "las-palmas-de-gc",
        meteo_code: "35016",
        path: "m 305.31861,144.32733 25.25381,-11.61676 13.63706,19.95052 9.09137,4.79822 -4.29315,7.82868 5.80838,-0.50507 10.35407,-9.34391 10.6066,-3.283 8.33376,0.75762 4.29314,7.07106 8.08122,2.02031 6.06092,-2.27284 -12.62691,-8.83884 -3.53553,-6.06091 -0.25254,-6.81853 -4.29315,-8.33376 6.56599,-14.89975 -4.04061,-7.07107 5.05077,-16.162441 -8.08122,-19.192899 -3.03046,0 -4.79823,-7.071068 3.53554,-6.060915 -3.03046,-1.767767 1.26269,-9.596449 3.283,3.788072 0,-4.293148 7.3236,0.252538 6.81853,-9.091373 0,-5.303301 2.52538,-9.596449 -2.52538,-6.060915 -13.13198,-2.020305 -8.5863,9.596449 -6.31345,0.757614 -1.26269,7.828682 6.56599,4.040611 2.02031,11.616754 -11.61676,13.384521 -19.95051,5.808377 -9.09137,-11.111678 -4.79823,0.505077 -6.81853,13.131983 -4.54569,0.252538 1.76777,5.555839 -1.51523,0 -1.76776,11.364216 -5.05077,0.757614 -0.75761,4.040611 -5.80838,14.899752 4.04061,4.79822 -8.5863,9.84899 -0.50507,6.06091 -2.02031,3.03046 -6.56599,6.81853 2.52538,4.29315 11.8693,-1.26269 z"
    },
    firgas: {
        path: "m 258.09398,55.938981 2.27284,12.626907 -13.63706,27.274119 2.77792,4.04061 -3.78807,8.586293 -0.50508,7.32361 23.73859,-8.08122 -3.78808,-6.81853 8.33376,-12.626907 -4.29315,-5.808377 7.82869,-18.94036 -2.77792,-11.616755 -4.04061,-1.515229 z",
        name: "firgas",
        meteo_code: "35008"
    },
    moya: {
        path: "m 260.8719,47.857761 -17.67767,3.282996 -8.33376,-5.050763 -2.27285,30.557115 5.05077,12.12183 -30.05204,35.102801 -3.03046,14.89975 4.29315,12.12183 1.76777,18.18275 8.33375,-13.63706 9.84899,-8.33376 0,-12.87945 7.57615,-7.57614 -3.53554,-1.76777 6.56599,-7.07107 5.80838,-1.76776 0,-7.32361 4.29315,-8.58629 -3.03046,-4.293153 14.14214,-27.274119 -2.77792,-13.131983 z",
        name: "moya",
        meteo_code: "35013"
    },
    guia: {
        path: "m 233.85031,45.584918 -8.83883,4.04061 -6.31345,-5.555839 -6.06092,2.525381 -2.0203,-6.818529 -3.78808,0 -3.53553,-4.798225 1.51523,-3.030458 -5.80838,-8.333758 -3.03046,2.272843 -2.77792,-3.282996 -9.84898,8.081221 6.56599,10.85914 0.50507,8.586296 4.29315,5.303301 -7.07106,2.525382 4.54568,21.970817 4.79823,2.272844 -3.78808,8.586296 -1.26269,33.335036 6.566,7.3236 0.25253,10.10153 9.09138,9.59645 -3.283,-12.12183 3.03046,-15.40483 29.7995,-34.597723 -5.05076,-12.879445 z",
        name: "guia",
        meteo_code: "35023"
    },
    galdar: {
        path: "m 183.09015,30.685168 -4.29315,-2.272843 -12.12183,5.555839 -12.37437,-2.77792 -1.76777,-7.828682 -7.07106,1.010152 -2.27285,5.303301 -5.80837,1.262691 -5.80838,-3.282996 0,5.808377 9.34391,8.081221 -4.54569,8.838834 2.02031,3.282996 0.50508,7.071068 -4.79823,3.030458 -3.03046,7.828682 2.77792,3.030458 15.40483,5.050762 16.16244,25.001274 4.04061,0.25254 13.63706,27.77919 -6.31345,4.04062 -0.50508,3.78807 -12.37437,2.77792 5.55584,4.79822 7.57614,-0.75761 10.85914,11.11167 9.84899,2.27285 12.87945,9.59645 -2.52539,-19.44544 -9.59644,-9.09137 -0.25254,-10.10153 -7.07107,-7.82868 1.76777,-33.082496 4.04061,-8.586296 -4.79823,-2.77792 -5.05076,-21.71828 7.32361,-2.525381 -4.04062,-5.303301 -0.75761,-9.091373 z",
        name: "galdar",
        meteo_code: "35009"
    },
    agaete: {
        path: "m 136.37059,75.636956 -5.05076,0.757614 1.51523,8.081221 -4.79822,4.545686 4.54568,6.313454 -11.61675,25.506349 -12.62691,6.56599 -3.53553,9.34392 -4.54569,1.76776 -3.535534,5.55584 4.293144,10.6066 -2.777915,5.55584 5.808375,2.52538 15.15229,-1.26269 21.46574,-20.45559 7.82868,2.52538 7.57615,-5.55583 7.82868,5.55583 12.37437,-3.28299 0.25254,-4.04061 6.31345,-3.283 -13.8896,-27.27412 -3.53553,-1.01015 -16.16244,-25.253812 z",
        name: "agaete",
        meteo_code: "35001"
    },
    teror: {
        path: "m 307.08637,94.324778 -10.6066,5.808382 -1.01015,8.08122 -8.33376,2.77792 -18.18274,-3.03046 -16.92006,32.32488 4.29315,9.34391 -0.75762,9.84899 -4.04061,1.76776 0.50508,5.05077 8.5863,1.51523 19.95051,-12.62691 24.24366,-11.11168 -1.76777,-2.52538 -11.86929,2.0203 -2.77792,-4.79822 9.09137,-9.59645 -0.75761,-6.06091 9.09137,-10.10153 -3.53553,-5.05076 z",
        name: "teror",
        meteo_code: "35027"
    },
    valleseco: {
        path: "m 268.70058,107.96184 -29.54696,9.84898 -6.31346,7.32361 3.283,2.02031 -7.07107,6.31345 -1.01015,13.13198 -8.83884,9.09138 -8.33376,14.14213 5.80838,1.76777 7.82868,7.57614 14.89975,-4.54568 12.62691,-7.82869 -0.75761,-5.05076 4.54568,-2.52538 0.50508,-9.34391 -4.29315,-9.84899 z",
        name: "valleseco",
        meteo_code: "35032"
    },
    telde: {
        path: "m 283.85287,233.97837 5.05076,5.05076 9.09137,2.52538 45.20433,-2.27284 5.80837,3.78807 17.1726,0.75762 0.75761,4.54568 12.37437,6.31345 16.66752,-5.05076 10.85914,3.03046 0.75761,4.79822 4.54569,3.53554 11.11168,-6.06092 9.09137,6.06092 1.51523,-6.06092 -8.08122,-3.53553 0,-5.55584 -9.84899,-3.78807 -0.25254,-2.27285 2.52538,-3.03045 -3.03045,-2.02031 2.52538,-4.29315 -1.51523,-5.05076 -3.78807,0.50508 3.53553,-10.6066 4.04061,0.50507 -3.53553,-9.09137 10.10152,-7.32361 -1.01015,-5.3033 -5.05076,-0.75761 -1.01016,-7.57615 2.77792,-3.28299 -10.10152,-7.07107 -1.01015,-11.86929 -8.08122,-3.78807 -7.07107,2.77792 -7.57615,-2.52539 -5.05076,-6.81853 -7.07107,-0.25253 -11.36421,3.28299 -9.84899,9.59645 -5.80838,0.25254 -22.47589,3.28299 -6.06092,6.06092 -5.55584,1.76777 6.566,2.52538 4.54568,3.53553 17.42513,-1.51523 2.27285,2.77792 1.26269,13.38452 -2.27285,1.76777 -0.25253,7.07107 -18.68783,5.55584 -6.81853,11.11168 -6.06091,0.25253 -17.93021,10.60661 -9.09137,-4.29315 z",
        name: "telde",
        meteo_code: "35026"
    },
    "santa-brigida": {
        path: "m 301.53054,184.98597 2.77791,-7.07107 9.84899,-1.01015 6.81853,-1.76777 6.56599,-6.56599 21.46574,-3.03046 3.78808,-8.33376 -10.10153,-5.05076 -12.12183,-18.94036 -50.50763,21.71828 5.80838,6.31345 2.27284,8.83884 z",
        name: "santa-brigida",
        meteo_code: "35021"
    },
    "san-mateo": {
        path: "m 301.278,185.23851 -16.41498,7.82868 -4.29315,0.25254 -10.85914,8.83883 -1.01015,19.69798 -3.78807,13.88959 -6.566,-6.06091 -8.08122,-0.50508 -19.44543,-23.73858 -5.3033,-25.50635 13.88959,-4.79823 12.87945,-8.83883 8.08122,2.0203 19.44544,-13.38452 6.81853,6.06092 1.26269,8.83883 z",
        name: "san-mateo",
        meteo_code: "35033"
    },
    valsequillo: {
        path: "m 283.34779,234.23091 2.77792,-4.54569 9.34391,4.54569 18.18275,-10.85914 5.80837,0.75761 6.31346,-11.86929 18.94036,-5.05076 0,-7.07107 2.27284,-2.27285 -1.76777,-12.37436 -1.76776,-3.78808 -17.67767,2.02031 -4.29315,-4.04061 -7.07107,-2.52538 -10.85914,0.75761 -2.52538,6.06092 -16.41498,9.84898 -4.79822,0 -9.84899,8.83884 -0.25254,19.44544 -4.79822,14.64721 z",
        name: "valsequillo",
        meteo_code: "35031"
    },
    ingenio: {
        path: "m 265.67012,237.5139 26.01143,7.82868 11.61675,9.84899 3.78807,-1.76777 30.80966,2.52539 20.20305,25.25381 15.65736,0.25254 6.31346,-4.29315 5.3033,5.3033 23.99112,5.3033 3.78807,-26.76904 -6.06091,-3.78807 -0.25254,-3.78808 -11.11168,-3.53553 -16.66752,4.54569 -12.37437,-6.06092 -1.01015,-4.29315 -17.42513,-1.01015 -5.05076,-3.78807 -44.95179,2.27284 -10.35406,-1.76777 -3.78808,-5.55583 z",
        name: "ingenio",
        meteo_code: "35011"
    },
    aguimes: {
        path: "m 266.1752,238.01898 10.6066,6.06091 14.64721,10.85914 8.08122,51.51778 37.37564,13.63706 16.16244,0.50508 3.53554,6.06091 17.42513,0.50508 2.02031,4.29315 7.82868,0.25254 5.3033,3.03045 0.25254,8.08122 5.05076,-2.52538 5.05076,-7.3236 6.56599,1.51523 5.55584,-2.27285 -2.27284,-12.37437 5.3033,-6.81853 -3.03046,-0.25253 -8.58629,-17.93021 5.55584,-7.07107 -23.73859,-4.54569 -4.79822,-5.55583 -6.06092,4.54568 -16.41498,-0.50507 -19.69797,-25.75889 -31.56727,-1.76777 -5.05076,1.76777 -9.84899,-10.35407 z",
        name: "aguimes",
        meteo_code: "35002"
    },
    "sta-lucia": {
        path: "m 273.4988,242.05959 4.29315,6.06091 -2.77792,10.60661 -11.36422,8.83883 4.04061,10.35406 -1.51522,15.90991 16.92005,15.9099 -5.3033,4.79822 9.09137,16.16244 -0.75761,4.79823 11.86929,1.01015 11.86929,8.08122 2.02031,-4.04061 10.35406,0.75762 7.57615,-4.04061 44.44671,45.45686 6.81853,-9.84899 -3.03046,-5.3033 4.04061,-20.96066 6.81853,-6.31346 -0.25254,-5.80837 -8.08122,-3.03046 -5.55584,0.50507 -1.51523,-5.3033 -17.9302,0.50508 -3.283,-6.81853 -15.9099,0.25254 -37.37565,-14.14214 -7.82868,-51.0127 z",
        name: "sta-lucia",
        meteo_code: "35022"
    },
    "san-bartolome-de-tir": {
        path: "m 373.75644,382.97587 -12.87944,6.31345 -19.44544,2.52538 -19.69797,2.52538 -16.16244,11.8693 -12.62691,-0.25254 -10.35407,10.85914 -27.27411,11.36421 -6.06092,20.45559 -5.55584,2.77792 -21.71828,-1.51523 -14.64721,-12.87944 -7.32361,4.04061 -27.52665,-12.37437 -14.89975,5.05076 -3.78807,-4.29314 9.34391,-7.32361 0.75761,-23.23351 -3.283,-4.54569 3.03046,-11.86929 6.06092,-8.33376 -3.78807,-10.6066 5.05076,-3.03046 1.76777,-9.09137 -0.75762,-20.20305 -10.85914,-15.65736 4.29315,-30.80966 4.29315,-2.52538 0.75761,-4.54568 28.28427,-27.02159 1.51523,-11.61675 14.14214,-3.283 7.82868,-11.61675 3.03046,2.02031 -0.75762,5.55583 7.32361,6.06092 18.68782,-8.33376 7.57615,0.75762 6.06091,6.31345 10.85914,7.07107 2.52538,5.80837 -2.77792,8.33376 -9.84898,9.59645 2.52538,10.35407 -0.75762,17.42513 16.41498,14.89975 -5.05076,4.54568 8.5863,16.41498 -0.25254,4.79823 11.86929,1.51523 11.86929,8.08122 0.75762,-4.54569 11.61675,0.50508 7.32361,-3.283 z",
        name: "san-bartolome-de-tir",
        meteo_code: "35019"
    },
    mogan: {
        path: "m 169.45309,277.16239 -6.06092,-5.55584 -9.34391,-0.25254 -6.31345,-7.07107 4.54569,-8.58629 0.50507,-8.5863 -7.82868,-6.31345 -14.89975,3.78807 -14.14214,-4.04061 -25.506347,28.78935 1.010152,16.16244 -8.333758,3.28299 -15.152288,28.28427 -17.930208,12.12184 9.343911,21.46574 6.313454,3.53553 11.111678,13.8896 13.384521,3.28299 1.515229,8.33376 4.545686,-1.26269 7.82868,12.37437 5.3033,-1.76777 7.07107,7.57615 0.50508,4.04061 7.57614,4.79822 12.37437,6.06092 0.75761,4.29315 1.2627,-1.01016 6.31345,0 6.81853,10.85914 -1.01015,7.07107 2.52538,-2.77792 9.09137,-7.3236 0.25254,-24.24367 -2.02031,-4.04061 3.03046,-11.11167 5.05076,-10.10153 -3.28299,-9.59645 4.54568,-2.77792 2.27285,-10.35406 -1.01016,-18.94036 -11.11167,-16.16244 5.3033,-30.55712 3.78807,-2.77792 z",
        name: "mogan",
        meteo_code: "35012"
    },
    tejeda: {
        path: "m 108.08632,250.14081 -2.77792,-14.89975 -9.596446,-7.32361 -1.767767,-27.27412 22.980973,10.35407 0.50507,-7.07107 14.14214,-7.57614 15.65736,6.06091 -0.25253,-3.78807 10.10152,-2.02031 6.31345,-10.6066 18.68783,3.78807 9.59645,-3.03045 17.9302,-16.16244 6.81853,1.76776 7.32361,7.32361 7.07107,27.02158 18.94036,22.72843 -18.18275,8.08122 -6.81853,-5.3033 1.76777,-5.80838 -4.29315,-3.03045 -8.33376,12.12183 -14.14213,3.53553 -1.51523,11.61675 -28.53681,26.76905 -6.81853,-6.31346 -10.10153,-0.50507 -4.79822,-6.56599 4.54568,-8.5863 0.25254,-8.5863 -7.57614,-7.57614 -14.39468,5.05076 -14.39467,-4.54569 z",
        name: "tejeda",
        meteo_code: "35025"
    },
    artenara: {
        path: "m 99.247488,139.02403 -19.697975,7.57614 -0.252538,6.81853 -6.565992,5.05076 20.203051,13.63706 3.535534,12.62691 -1.515229,16.41498 21.213201,9.09137 1.01016,-6.06091 14.89975,-8.33376 14.89975,7.07107 0,-3.78808 10.6066,-2.77791 5.55584,-9.84899 19.44543,3.03046 10.35407,-3.03046 14.89975,-16.92006 -10.85914,-8.58629 -9.09138,-2.02031 -11.11167,-10.85914 -7.57615,0.25254 -13.38452,-10.10153 -6.81853,5.55584 -9.59645,-2.27284 -20.45559,20.45559 -15.15229,1.01015 -5.808373,-2.77792 3.282993,-5.55584 -4.545684,-10.85914 z",
        name: "artenara",
        meteo_code: "35005"
    },
    "la-aldea": {
        path: "m 72.225907,158.722 21.213204,13.8896 2.525381,12.12183 -2.525381,16.16244 1.767766,28.28427 10.101523,6.81853 0.75762,13.38452 -15.909905,19.69798 1.010152,16.41498 -9.091373,3.78807 L 68.185297,317.56849 49.497475,327.92255 36.365492,295.59767 21.71828,277.92 l -1.515229,-6.56599 6.565991,-28.28427 -5.808377,-24.24366 7.071068,-9.34391 -1.262691,-6.81853 4.293149,-1.01015 5.303301,-15.90991 -5.555839,-9.09137 8.838834,-4.29315 8.081221,2.27285 10.354063,-4.04061 z",
        name: "la-aldea",
        meteo_code: "35020"
    }
};

$(function() {

//    initializeMapMeteo();
    initializeConoceGC();
    //handler de las rutas y demas contenidos.
    
    $("body").on("click", ".load_municipio", function(event){

        var accion=$(this).attr("href"); 
        
        var url = location.href + "?ajax="+accion;
        
        $.ajax({
            url: url,
            timeout: 4000,
            type: "GET"
//            data: { file: file.name }
        }).done(function(data){

            try{
                datos = JSON.parse(data);
            }
            catch(e) {
                 return;
            }

            $("body").append(datos.datos);
            $(datos.datos).hide().fadeIn(200);

            if ( !$("#pageBannerWrapper").hasClass("bottom") ) {
                $("#pageBottomWrapper").animate({
                    "bottom":"-556px"
                },200,function(){
                    $(this).addClass("bottom");
                });
            }

            $("#pageFooterWrapper").css("zIndex", "-2");
            
            if ( $(".ruta_detail").size()>0 ) {
                //Codigo para la inicializacion de la galeria incrustrada dentro de las rutas.
                $('.iosslider_ruta').iosSlider('destroy');
                $('.iosslider_ruta').iosSlider({   
                    desktopClickDrag: true,
                    snapToChildren: true,
                    navNextSelector: $('.iosslider_ruta .next'),
                    navPrevSelector: $('.iosslider_ruta .prev'),
                    autoSlideHoverPause: true,
                    //autoSlide: true,
                    autoSlideTimer: 2000,
                    infiniteSlider: true,
                    autoSlideToggleSelector: $('.iosslider_ruta .gallery_play')
                });




                //Acciones para cuando se pique en el iosslider
                $(".iosslider_ruta").mousedown(function(){
                    $('.iosslider_ruta .gallery_play').removeClass("play");
                    $('.iosslider_ruta').iosSlider('autoSlidePause');
                })
                //Acciones del boton siguiente iosslider
                $('.iosslider_ruta .next').click(function(){
                    $('.iosslider_ruta .gallery_play').removeClass("play");
                    $('.iosslider_ruta').iosSlider('autoSlidePause');
                })
                //Acciones del boton previo iosslider
                $('.iosslider_ruta .prev').click(function(){
                    $('.iosslider_ruta .gallery_play').removeClass("play");
                    $('.iosslider_ruta').iosSlider('autoSlidePause');
                });


                $('.iosslider_ruta .gallery_play').click(function(){
                    $(this).toggleClass("play");

                    if($(this).hasClass("play")){
                        $('.iosslider_ruta').iosSlider('autoSlidePlay');

                    }
                    else{
                        $('.iosslider_ruta').iosSlider('autoSlidePause');
                    }
                });
				$('.iosslider_ruta .gallery_play').mousedown(function(event){
                    event.stopPropagation();
                })
                setTimeout(function(){
                    $('.iosslider_ruta .gallery_play').click();
                }, 1000);
                
            }
        }).fail(function(){
            //No hay conexion (se fue justo con la pantalla abierta al cambio de locaclidad)
            
        });
    });
});


function initializeMapMeteo() {
    if ($("#map").length > 0) {
        //este es el mapa de Gran Canaria para el tiempo. 
        var a = Raphael("map", 454, 454);
        var b = {
            fill: "#7b7b7b",
            stroke: "#fff",
            "stroke-width": 1,
            "stroke-linejoin": "round"
        };
        var c = new Array;
        var d = new Array;

        for (var e in paths) {

            var f = a.path(paths[e].path);

            f.attr(b);
            c[f.id] = e;
            d[e] = f;

            //console.log(f);

            if (e == "san-bartolome-de-tir") {
                $.mapObjectActive = f;
                f.animate({
                    fill: "#434343",
                    scale: "+=0.33"
                }, 300);
            }

            f.click(function() {//captura del click

                var a = $("a." + c[this.id]);

                //controlamos que no se este realizando ya una peticion para obtener los datos
                if ($.mapObjectNoLoad) {
                    return;
                }
                $.mapObjectNoLoad = true;


                if ($.mapObjectActive) {
                    $.mapObjectActive.animate({
                        fill: "#7b7b7b",
                        scale: "1"
                    }, 200);
                }

                $.mapObjectActive = this;
                this.animate({
                    fill: "#434343",
                    scale: "1.33"
                }, 300);


                var a = $("a." + c[this.id]);
                a.css({
                    "background-color": "#666"
                });

                generarGraficaMeteorologica(paths[ c[this.id] ].meteo_code, function() {
                    //    ya se realizo el load y se dibujo la grafica
                    $.mapObjectNoLoad = false;
                });

                //document.location = a.attr("href")
            });
        }
    }
}

function initializeConoceGC() {
    //este es el mapa de Gran Canaria para los municipios.
    if ($("#map_municipio").length > 0) {
        var a = Raphael("map_municipio", 454, 454);
        var b = {
            fill: "#FFFFFF",
            stroke: "#777777",
            "stroke-width": 1,
            "stroke-linejoin": "round"
        };
        var c = new Array;
        var d = new Array;

        for (var e in paths) {
            var f = a.path(paths[e].path);
            f.attr(b);
            c[f.id] = e;
            d[e] = f;

            f.click(function() {        //captura del click
                //console.log("entraste en el que no era.....");

                setColorForSectionActive(this);
                //$.mapObjectNoLoad = false;
            });

            $("#" + paths[ e ].meteo_code).data("obj-related", "" + paths[e].name);
            $("#" + paths[ e ].meteo_code).data("obj-id", "" + f.id);

            $("#" + paths[ e ].meteo_code).click(function() {
                setColorForSectionActive(d[ $(this).data("obj-related") ]);
            });

        }
    }

    if ($(".owl-carousel").size() > 0) {
        $(".owl-carousel").owlCarousel2({
            navigation: true,
            items: 5, //10 items above 1000px browser width
            itemsDesktop: [1000, 5], //5 items between 1000px and 901px
            itemsDesktopSmall: [900, 3], // betweem 900px and 601px
            itemsTablet: [600, 2], //2 items between 600 and 0
            itemsMobile: false // itemsMobile disabled - inherit from itemsTablet option

        });
    }

    if ($(".listado-wrapper h3").size() > 0) {
        $(".listado-wrapper h3").click(function() {
            var target1 = $(this).siblings(".municipio_wrapper");
            var target2 = $(this).parents(".conoce_wrapper").find(".full_contenido_wrapper");

            if (target1.is(":visible")) {
                //debo cerrarlo y animar hacia arriba el target2.
                target1.siblings(".to_flip").fadeOut(400);
                target1.stop().animate({
                    height: "0px"
                }, 400, function() {
                    $(this).hide();
                });
                target2.stop().animate({
                    height: "+=333px"
                }, 400);
            }
            else {
                //debo abrirlo y animar hacia abajo el target2.
                target1.siblings(".to_flip").fadeIn(400);
                target1.show().stop().animate({
                    height: "+=333px"
                }, 400, function() {
                });

                target2.stop().animate({
                    height: "-=333px"
                }, 400);
            }
        });
    }

    $(".menu_tiempo_contenido .sub-menu-elmt").unbind().click(function() {
        if ($(this).hasClass("active"))
        {
            return;
        }

        $(this).siblings(".active").removeClass("active");
        $(this).addClass("active");

        var municipio_id = "";
        if ($(".municipio_element.active").size() > 0)
        {
            municipio_id = $(".municipio_element.active").attr("id");
        }

        cargar_contenido_municipio2(municipio_id, function() {
            $.map2ObjectNoLoad = false;
        });
    });
}

/***********************************************************************/

////////////////////////////////////////////////////////////////////

//Inicializar los destinos

function initializeDestinos() {

    /*$($(".menu_tiempo_contenido .sub-menu-elmt")[0]).click();*/
    
    //Hacer click en el menu de arriba
    $(".menu_tiempo_contenido .sub-menu-elmt").unbind().click(function() {
        if ($(this).hasClass("active"))
        {
         
            return;

        }
        
        $(this).siblings(".active").removeClass("active");
        $(this).siblings().children().removeClass("active");
        $(this).addClass("active");
        $(this).children(":first").addClass("active");


        var municipio_id = "";
        if ($(".municipio_element.active").size() > 0)
        {
            municipio_id = $(".municipio_element.active").attr("id");
        }

        cargar_contenido_municipio2(municipio_id, function() {
            $.map2ObjectNoLoad = false;
        });
    });

    //Hacer click en las areas (falseo el click en el menu)
    
    $('.zona_mapa_click').click(function(){
       var elemento = $(this).attr('id');
       $('.js_destino_menu_click_'+elemento).click();
    });


}


///////////////////////////////////////////////////////////////////


function setColorForSectionActive(obj) {

    //controlamos que no se este realizando ya una peticion para obtener los datos
    if ($.map2ObjectNoLoad) {
        return;
    }
    $.map2ObjectNoLoad = true;

    $(".municipio_element.active").removeClass("active");
    var meteoCode;

    $(".municipio_element").each(function() {
        if ($(this).data("obj-id") == obj.id) {
            $(this).addClass("active");
            meteoCode = $(this).attr("id");
        }
    });


    if ($.map2ObjectActive) {
        $.map2ObjectActive.animate({
            fill: "#ffffff"
        }, 200);
    }

    $.map2ObjectActive = obj;
    obj.animate({
        fill: "#A3BE06",
    }, 300);

    cargar_contenido_municipio2(meteoCode, function() {
        $.map2ObjectNoLoad = false;
    });
}




function cargar_contenido_municipio2(municipio, callback) {
    var accion;
    if (municipio != "")
    {
        initialice_loading_municipio($("#" + municipio).find(".carga_municipio_2"));
        //obtenemos la sección activa.
        accion = $("#" + municipio).parents(".closeWrapper").find(".sub-menu-elmt.active").data("accion");
    }
    else
    {
        accion = $(".menu_tiempo_contenido .sub-menu-elmt.active").data("accion");
    }

    $.get("index.php?ajax=getConoce_municipioInfo&municipio=" + municipio + "&accion=" + accion, function(data) {

        verificar_actualizacion(data);
        stop_loading_municipio();

        var responseDatos;

        try {
            responseDatos = JSON.parse(data);
        }
        catch (e) {
            //que hago?
            if (typeof callback == "function") {
                callback();
            }
            return;
        }

        /* ya se ha recibido la respuesta desde el servidor. Ahora debemos analizar que se hace, hay 2 situaciones.
         * - que haya un municipio seleccionado
         *   En este caso debemos mostrar el contenido y ademas hacer "click" para cerrar el desplegable de seleccionar zonas.
         * - que no haya un municipio seleccionado
         *   En este caso solamente debemos mostrar la información y nada mas. */
        $(".conoce_wrapper .full_contenido_wrapper").fadeOut(250, function() {

            //en caso de que hubiera un municipio Y el .full_contenido_wrapper NO estuviera 100% desplegado
            //habria que realizar la logica de ocultar el listado de zonas para poder desplegar correctamente
            //el contenido nuevo.
            $(this).children().remove();
            $(this).append(responseDatos.datos);


            var municipio_nombre = $("#" + municipio).find(".texto_slider").text();
            $("#municipio_nombre_wrapper").text(municipio_nombre);
            console.log(municipio_nombre);

            //ahora aqui debemos evaluar si es la información de un municipio o si es la información generica de la isla.
            $(this).fadeIn(250, function(){
                if ( $(".municipio_wrapper").is(":visible") ) {
                    $(".listado-wrapper h3").click();
                }

                var $container=$('.container-isotope').isotope({
                    itemSelector: '.item',
                    layoutMode: 'masonry',
                    masonry: {
                        gutter:1,
                        columnWidth: 140
                    }
                });

                $container.on( 'click', '.item', function() {
                    $('.full_contenido_wrapper').addClass('full_size_gallery');

                    //Constructor iosslider
                    $('.iosslider').iosSlider({   
                        desktopClickDrag: true,
                        snapToChildren: true,
                        navNextSelector: $('.iosslider .next'),
                        navPrevSelector: $('.iosslider .prev'),
                        autoSlide: false,
                        autoSlideTimer: 2000,
                        infiniteSlider: true,
                        autoSlideHoverPause: true,
                        autoSlideToggleSelector: $('.iosslider .gallery_play')
                    });
                    $('.iosslider').iosSlider('goToSlide', $(this).attr("id"));
                    $('.container-isotope').addClass("hidden");
                    $('.iosslider').removeClass("hidden");
                });
                //Acciones para cuando se pique en el iosslider
                $(".iosslider").mousedown(function(){
                    $('.iosslider .gallery_play').removeClass("play");
                    $('.iosslider').iosSlider('autoSlidePause');
                })
                //Acciones del boton siguiente iosslider
                $('.iosslider .next').click(function(){
                    $('.iosslider .gallery_play').removeClass("play");
                    $('.iosslider').iosSlider('autoSlidePause');
                })
                //Acciones del boton previo iosslider
                $('.iosslider .prev').click(function(){
                    $('.iosslider .gallery_play').removeClass("play");
                    $('.iosslider').iosSlider('autoSlidePause');
                });
                //Acciones del boton cerrar iosslider
                $('.iosslider .gallery_close').click(function(){
                   $('.iosslider').addClass("hidden");
                   $('.container-isotope').removeClass("hidden");
                   $('.full_contenido_wrapper').removeClass('full_size_gallery');
                   $('.iosslider').iosSlider('destroy');
                });
                //Acciones del boton play / pause
                $('.iosslider .gallery_play').click(function(event){
                    event.stopPropagation();

                    $(this).toggleClass("play");
                    if($(this).hasClass("play")){
                        $('.iosslider').iosSlider('autoSlidePlay');
                    }
                    else{
                        $('.iosslider').iosSlider('autoSlidePause');
                    }
                });

                $('.iosslider .gallery_play').mousedown(function(event){
                    event.stopPropagation();
                })
            });
           
            
        });
        
        if (typeof callback == "function") {
            callback();
        }
        return;



        var originObject = $("#conoceWrapper:visible .menuContent:visible");

        if (!originObject) {
            if (typeof callback == "function") {
                callback();
            }
            return false;
        }
        if (responseDatos.error) {

        }
        else {
            originObject.children().fadeOut("200", function() {
                $(this).addClass("menuContentHidden");
            });

            originObject.append(responseDatos.datos);
            var newChild = $(originObject).children(":last");

            newChild.hide();

            newChild.setColorToSubsectionElements(originObject)

            var color = $(".mainMenuElement a[href=#" + $(originObject).parents(".menuContentWrapper").attr("id") + "]").parents(".mainMenuElement").attr("color");

            newChild.find(".tabs_").tabs();
            $(this).find("ul.ui-tabs-nav").css({
                position: "absolute",
                right: "55px",
                top: "-2px"
            });
            newChild.find("ul").click(function() {
                $(".ui-state-default a", $(this)).css({
                    color: "black"
                });
                $(".ui-state-default", $(this)).css({
                    backgroundColor: "white"
                });
                $(".ui-state-active", $(this)).css({
                    backgroundColor: color
                });
                $(".ui-tabs-active a", $(this)).css({
                    color: "white"
                });
            }).click();


            newChild.find(".scroll").css({
                height: "420px"
//                height: "97%"
            }).setSlimScroll();

            newChild.setPositionsForSection(function() {
                rotar_fotos_galeria();
                initializeFlipListener();
            });


            if (typeof callback == "function") {
                callback();
            }
        }
        removeOverlayContentLoadingGif();
    }).fail(function() {

        if (typeof callback == "function") {
            callback();
        }
        removeOverlayContentLoadingGif();
    });
    ;
}



function cargar_contenido_municipio(municipio, callback) {

    initialice_loading_municipio($("#" + municipio).find(".carga_municipio_2"));
    $.get("index.php?ajax=getConoce_municipioInfo&municipio=" + municipio, function(data) {

        verificar_actualizacion(data);
        stop_loading_municipio();

        var responseDatos;

        try {
            responseDatos = JSON.parse(data);
        }
        catch (e) {
            //que hago?
            if (typeof callback == "function") {
                callback();
            }
            return;
        }
        /* ahora miro a ver cual es el elemento activo para a partir de ahi realizar la operativa.
         * la logica es:
         * - Hace click en un municipio.
         * - En funcion del municipio y la seccion activa realizo una petición al servidor para obtener los atributos de esa sección
         * 
         */
        var originObject = $("#conoceWrapper:visible .menuContent:visible");

        if (!originObject) {
            if (typeof callback == "function") {
                callback();
            }
            return false;
        }
        if (responseDatos.error) {

        }
        else {
            originObject.children().fadeOut("200", function() {
                $(this).addClass("menuContentHidden");
            });

            originObject.append(responseDatos.datos);
            var newChild = $(originObject).children(":last");

            newChild.hide();

            newChild.setColorToSubsectionElements(originObject)

            var color = $(".mainMenuElement a[href=#" + $(originObject).parents(".menuContentWrapper").attr("id") + "]").parents(".mainMenuElement").attr("color");

            newChild.find(".tabs_").tabs();
            $(this).find("ul.ui-tabs-nav").css({
                position: "absolute",
                right: "55px",
                top: "-2px"
            });
            newChild.find("ul").click(function() {
                $(".ui-state-default a", $(this)).css({
                    color: "black"
                });
                $(".ui-state-default", $(this)).css({
                    backgroundColor: "white"
                });
                $(".ui-state-active", $(this)).css({
                    backgroundColor: color
                });
                $(".ui-tabs-active a", $(this)).css({
                    color: "white"
                });
            }).click();


            newChild.find(".scroll").css({
                height: "420px"
//                height: "97%"
            }).setSlimScroll();

            newChild.setPositionsForSection(function() {
                rotar_fotos_galeria();
                initializeFlipListener();
            });


            if (typeof callback == "function") {
                callback();
            }
        }
        removeOverlayContentLoadingGif();
    }).fail(function() {

        if (typeof callback == "function") {
            callback();
        }
        removeOverlayContentLoadingGif();
    });
    ;
}
